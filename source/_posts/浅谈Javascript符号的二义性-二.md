---
title: 浅谈Javascript符号的二义性(二)
date: 2016-05-12 21:21:21
tags: Javascript
categories: 前端

---

## 前言
前天抽了点时间写了[浅谈Javascript符号的二义性(一)](http://www.haihuiling.top/2016/05/10/%E6%B5%85%E8%B0%88Javascript%E7%AC%A6%E5%8F%B7%E7%9A%84%E4%BA%8C%E4%B9%89%E6%80%A7.%E4%B8%80/#more)，写完之后发现离开符号的优先级讨论符号的二义性是不行的。于是我在这篇博客中将加上符号优先级的分析，以期更精确地摸到本质。这次将讨论`，`和`[]`符号的二义性。

<!-- more -->

---

## 符号优先级

贴上从网上找的一张介绍Javascript符号优先级的表格。下表按从最高到最低的优先级列出JavaScript运算符。具有相同优先级的运算符按从左至右的顺序求值。
  
 |运算符|描述        |
  |---------------------------------|---------------------------------------------|
  |. [] ()|字段访问、数组下标、函数调用以及表达式分组|
  |++ -- - + ~ ! delete new typeof void|前/后增量、前/后减量、求反 转换成数字、按位求反、逻辑非、删除属性、检测操作数类型、返回undefined|
  |\* / %|乘法、除法、取模|
  |\+ \- \+|加法、减法、字符串连接|
  |<< >> >>>|移位|
  |< <= > >= instanceof	|小于、小于等于、大于、大于等于、instanceof|
  |== != === !==|	等于、不等于、严格相等、非严格相等|
  |&|	按位与|
  |^|	按位异或|
  |&#124;|按位或|
  |&&|	逻辑与|
  |&#124;&#124;|逻辑或|
  |?:|条件运算符|
  |= oP=|赋值、运算赋值|
  |,	|多重求值|
  
 
  更详细的运算符介绍可参考Javascript's Bable=>《Javascript权威指南》,
  但了解上面的运算符已足矣。巧的是这次我要介绍的`[]`,`,`竟分别位于优先级最高和最低两个层级，哈哈，有意思！
  
  ----
 
## 逗号`,`的二义性

先来看两行语句：
```javascript
a = (1,2,3); //3
a = 1,2,3; //3
```
这两行代码的效果都会返回3,但是原因却是不一样的，而且最终a的值也不同。
对于第一句，由于括号具有最高的优先级，所以先运算括号里面的语句，由于里面是三个单值表达式连续运算，即是下面这个语句产生的效果：
```javascript
2;  //输出2
```
又由于`,`运算符会从左到右依次运算，所以括号里面的语句最终会返回`3`,并且把值赋给a,即a的值为3。`a=3`语句的副作用是返回3,所以最后会输出`3`。
对于第二个语句，根据符号的优先级，先运算`a=1`这个语句，再依次运行后面的语句，返回最后一个数的值。所以a的值为`1`，而最终也输出`3`。
这就是`,`作为运算符时的效果。
另外，值得一提的是，下面这条语句是会报错的：
```javascript
var a = 1,2,3;//SyntaxError: missing variable name
```
这是一个变量声明语句。至于为什么会报错，这就涉及到赋值语句与变量声明语句之间的区别的问题了，有空的时候也将这个话题探讨一下。
下面再看这条语句：
```javascript
a = [1,2,3,(4,5),6,8] //[1,2,3,5,6,8]
```
要理解这个表达式的结果就得知道`,`的另一个作用：语法分隔符。在上面的语句中前3个和后2个就是作为语法分隔符而存在的，这是javascript数组的语法。而括号里面的`,`是起到运算符的作用，所以有这样的结果也好理解了。
而且`var a = 1,2,3;`的`,`也是作为语法分隔符存在的。
最后再看下面的语句：
```javascript
var i =100;
alert(i+=20,i*2,'a'+i) // 120
```
在上面的alert函数中，`,`作为语法分隔符。
上面的语句相当于：
```javascript
alert(120,240,'a240')
```
又由于alert只能接收一个参数，所以将弹出`120`,忽略后面的参数值。
若要输出后面的`a240`,则需要加`()`强制运算：
```
alert((i+=20,i*2,'a'+i)) //a240
```
但i的值最终都是`240`。

---

## 方括号`[]`的二义性
方括号`[]`的二义性主要体现在它既可作用来声明数组的直接量，又可以是存取数组下标的运算符。
考虑以下语句：
```javascript
a = [[1][1]]; //[ undefined ]
```
这个语句比较奇怪。不懂没关系，再观察下面的语句：
```javascript
a = [[1][0]]; // [1]
```
看到这两个结果应该就能理解为什么会有这样的结果了。
Js引擎将最外一层的`[]`和里面的第一个`[]`理解为数组声明的括号，而将里面的第二个`[]`理解为存取数组下标的运算符。这样就好理解了。
所以下面的代码的结果就可以理解了：
```javascript
a = [[1][1][1]]//TypeError: [1][1] is undefined
a = [[][100]] //Array [ undefined ]
a = [[1,2,3][2]] // [3]
//里面第一个数组为空，而下标缺少索引，所以会报错
a = [[][]] // SyntaxError: expected expression, got ']'
```
最后再来看一个例子：
```javascript
var table =[
['A',1,2,3] //缺少逗号
['B',4,5,6],
['C',7,8,9]
]
```
上面这个语句包含了`,`和`[]`的二义性。
最后的结果是:
```
['undefined',['C',7,8,9]]
```

Js引擎将里面的第一个和第三个`[]`理解为数组声明，第二个理解为存取数组下标的运算符，而第二个括号里面的','理解为连续运算符，所以有以上的结果。
 
 ---

## 总结
今天归纳了一下`,`和`[]`的二义性。`,`产生二义性的原因是它既可以作为连续运算符也可以作为分隔符。`[]`产生二义性的原因是它既可以理解为数组声明也可以理解为存取数组下标的运算符。针对它们的具体情景已作了介绍。如果有哪里说的不对的地方还请各位小伙伴不吝指正！

---

## 参考资料
> [Javascript语言精髓与编程实践][1]

[1]:  "http://www.duokan.com/book/84607" "Javascript语言精髓与编程实践 周爱民"
